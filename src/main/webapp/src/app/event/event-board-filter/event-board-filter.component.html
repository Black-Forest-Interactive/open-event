<div class="d-flex flex-column gap-2 h-100">
  <mat-card class="h-100">
    <mat-card-header class="p-2" style="height: 35px;">
      <mat-card-title class="d-flex flex-row gap-2 align-items-center">
        <mat-icon>filter_list</mat-icon>
        Filter
      </mat-card-title>
    </mat-card-header>
    <mat-divider class="pb-2"></mat-divider>
    <mat-card-content class="pb-2">
      <div class="d-flex flex-column gap-2 align-items-center">
        <mat-chip-listbox class="mat-mdc-chip-set-stacked">
          <mat-chip-option color="accent" (click)="selectToday()">
            <div class="d-flex flex-row gap-2 align-items-center">
              <mat-icon>today</mat-icon>
              {{ 'event.filter.range.today' | translate }}
            </div>
          </mat-chip-option>
          <mat-chip-option color="accent" (click)="selectThisWeek()">
            <div class="d-flex flex-row gap-2 align-items-center">
              <mat-icon>date_range</mat-icon>
              {{ 'event.filter.range.week' | translate }}
            </div>
          </mat-chip-option>
          <mat-chip-option color="accent" (click)="selectNextWeek()">
            <div class="d-flex flex-row gap-2 align-items-center">
              <mat-icon>next_week</mat-icon>
              {{ 'event.filter.range.next' | translate }}
            </div>
          </mat-chip-option>
        </mat-chip-listbox>

        <div class="flex-fill">
          <mat-form-field class="dense-1" subscriptSizing="dynamic">
            <mat-label>Enter a date range</mat-label>
            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
              <input matStartDate formControlName="start" placeholder="Start date">
              <input matEndDate formControlName="end" placeholder="End date">
            </mat-date-range-input>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker (closed)="onDateRangePickerClosed()" #picker></mat-date-range-picker>

            @if (range.controls.start.hasError('matStartDateInvalid')) {
              <mat-error>Invalid start date</mat-error>
            }
            @if (range.controls.end.hasError('matEndDateInvalid')) {
              <mat-error>Invalid end date</mat-error>
            }

          </mat-form-field>
        </div>
      </div>
    </mat-card-content>
    @if (allCategories.length > 0) {
      <mat-divider class="pb-2"></mat-divider>
      <mat-card-content class="pb-2">

        <div class="flex-fill">
          @if (reloadingCategories) {
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          } @else {
            <mat-form-field class="dense-1" subscriptSizing="dynamic">
              <mat-label>{{ "STRUCT.ACTION.SELECTED_CAT" | translate }}</mat-label>
              <mat-select [formControl]="categoryForm" multiple>
                <mat-option *ngFor="let category of allCategories" [value]="category">{{ category.name }}</mat-option>
              </mat-select>
            </mat-form-field>
          }
        </div>
      </mat-card-content>
    }
    <mat-divider class="pb-2"></mat-divider>
    <mat-card-content class="pb-2">
      <div class="d-flex flex-column gap-2 align-content-stretch align-items-stretch">

        <button mat-flat-button (click)="service.showHistory = !service.showHistory"
                [color]="service.showHistory ? 'accent' : 'primary'" class="flex-fill">
          <mat-icon>history</mat-icon>
          {{ 'event.filter.history' | translate }}
        </button>

        <button mat-flat-button (click)="service.ownEvents = !service.ownEvents"
                [color]="service.ownEvents ? 'accent' : 'primary'">
          <mat-icon>copyright</mat-icon>
          {{ 'event.filter.own' | translate }}
        </button>

        <button mat-flat-button (click)="service.availableEvents = !service.availableEvents"
                [color]="service.availableEvents ? 'accent' : 'primary'">
          <mat-icon>event_available</mat-icon>
          {{ 'event.filter.available' | translate }}
        </button>

        <button mat-flat-button (click)="service.participatingEvents = !service.participatingEvents"
                [color]="service.participatingEvents ? 'accent' : 'primary'">
          <mat-icon>3p</mat-icon>
          {{ 'event.filter.participating' | translate }}
        </button>
      </div>
    </mat-card-content>
    <div class="flex-fill"></div>
    <mat-divider class="pb-2"></mat-divider>
    <mat-card-content>
      <div class="d-flex flex-column gap-2 align-content-stretch align-items-stretch">
        <button mat-flat-button (click)="service.resetFilter()" color="warn">
          <mat-icon>cancel</mat-icon>
          {{ 'event.filter.reset' | translate }}
        </button>

        <button mat-flat-button (click)="service.filterToolbarVisible = false" color="primary">
          <mat-icon>filter_alt</mat-icon>
          {{ 'event.filter.hide' | translate }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
